{
  "instance_id": "scholl-lab__variantcentrifuge-69",
  "repo": "scholl-lab/variantcentrifuge",
  "base_commit": "7f8ecef800e72e3197b223faa020fb2231f212bb",
  "version": "0.9",
  "created_at": "2026-02-13T17:28:40.201663+00:00",
  "problem_statement": "Add dbNSFP v5.2a-compatible filter presets\n\n## Problem\n\nThe built-in filter presets in `config.json` reference dbNSFP v4.x field names that no longer exist in dbNSFP v5.2a. When using annotated VCFs produced with dbNSFP 5.2a, all frequency-based presets silently fail to match.\n\n### Affected field names\n\n| Preset field (v4.x) | dbNSFP v5.2a equivalent |\n|---|---|\n| `dbNSFP_gnomAD_exomes_AC` | `dbNSFP_gnomAD4.1_joint_AC` |\n| `dbNSFP_gnomAD_exomes_AF` | `dbNSFP_gnomAD4.1_joint_AF` |\n| `dbNSFP_gnomAD_genomes_AC` | removed (use `gnomAD4.1_joint_AC`) |\n| `dbNSFP_gnomAD_genomes_AF` | removed (use `gnomAD4.1_joint_AF`) |\n\n### Affected presets\n\nAll presets that filter on population frequency are affected:\n- `5percent`, `5percent_or_pathogenic`, `1percent`, `rare`, `super_rare`\n- `mutect2_TvsN_pass`, `mutect2_TvsN`, `mutect2_To_pass`\n- `aif`\n\n### Example\n\nv4.x preset `rare`:\n```\n(((dbNSFP_gnomAD_exomes_AF[0] < 0.0001) | (na dbNSFP_gnomAD_exomes_AC[0]))\n & ((dbNSFP_gnomAD_genomes_AF[0] < 0.0001) | (na dbNSFP_gnomAD_genomes_AC[0])))\n```\n\nv5.2a equivalent (simpler \u2014 single joint field replaces exome+genome):\n```\n((dbNSFP_gnomAD4.1_joint_AF[0] < 0.0001) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\n```\n\n## Suggested solution\n\n1. Add a parallel set of v5.2a-compatible presets (e.g., `rare_v5`, `super_rare_v5`, `mutect2_TvsN_pass_v5`) or a `dbnsfp_version` config key that switches field names automatically.\n2. Update `fields_to_extract` defaults to include `dbNSFP_gnomAD4.1_joint_AC` / `dbNSFP_gnomAD4.1_joint_AF` as alternatives.\n3. Document the field name mapping in the README for users migrating from v4.x to v5.x annotation databases.\n\n## Context\n\nDiscovered while setting up variantcentrifuge on the Charit\u00e9 HPC where sm-vcf-annotation uses dbNSFP 5.2a (see scholl-lab/sm-vcf-annotation#14). The BIH HPC setup still uses v4.x field names.",
  "patch": "diff --git a/README.md b/README.md\nindex 283a9af..4b6f353 100644\n--- a/README.md\n+++ b/README.md\n@@ -26,13 +26,18 @@\n - **\ud83d\udc65 Cohort Analysis:** Aggregate results from multiple samples with interactive visualizations\n - **\ud83c\udfa8 Custom Scoring:** Apply configurable variant scoring models without code changes\n - **\u26a1 Performance Optimized:** Parallel processing, memory-efficient streaming, and chunked analysis\n+- **\ud83d\udc33 Docker Support:** Pre-built image on GHCR with all bioinformatics tools \u2014 zero local setup\n+- **\ud83d\udd04 Field Profiles:** Seamless switching between annotation database versions (dbNSFP v4/v5) without config changes\n \n ## \ud83d\ude80 Quick Start\n \n ### Installation\n \n ```bash\n-# Install from PyPI (recommended)\n+# Docker (quickest \u2014 all tools included)\n+docker pull ghcr.io/scholl-lab/variantcentrifuge:latest\n+\n+# Install from PyPI\n pip install variantcentrifuge\n \n # Or install from source\ndiff --git a/docs/source/changelog.md b/docs/source/changelog.md\nindex c940832..58e1f0d 100644\n--- a/docs/source/changelog.md\n+++ b/docs/source/changelog.md\n@@ -8,6 +8,16 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n ## [Unreleased]\n \n ### Added\n+- **Docker image** on GHCR (`ghcr.io/scholl-lab/variantcentrifuge`) with all bioinformatics tools pre-installed:\n+  - Multi-stage build using micromamba for minimal image size\n+  - CI/CD pipeline with automated builds, Trivy security scanning, and cosign image signing\n+  - `docker-compose.yml` with volume mount patterns for data, snpEff databases, and custom scoring configs\n+  - Non-root container for security best practices\n+- **Field profiles** for annotation database version compatibility (`--field-profile`):\n+  - Built-in `dbnsfp4` and `dbnsfp5` profiles for seamless gnomAD field switching\n+  - Template syntax `{{fragment:param}}` for parameterized filter presets\n+  - `--list-field-profiles` to show available profiles\n+  - Custom profiles configurable in `config.json` without code changes\n - Comprehensive Sphinx documentation with modern Furo theme\n - GitHub Actions workflow for automated documentation deployment\n - API reference documentation with autodoc\ndiff --git a/docs/source/configuration.md b/docs/source/configuration.md\nindex a9c9128..2fa197d 100644\n--- a/docs/source/configuration.md\n+++ b/docs/source/configuration.md\n@@ -99,6 +99,82 @@ The default configuration includes many useful presets:\n - **`not_artefact`** - Quality-based artifact filtering\n - **`mutect2_TvsN_pass`** - Tumor vs Normal Mutect2 filters with PASS only\n \n+## Field Profiles\n+\n+Field profiles handle differences between annotation database versions \u2014 for example, dbNSFP v4.x and v5.x use different gnomAD field names. Instead of maintaining separate config files, you define profiles once and switch between them at runtime.\n+\n+### How It Works\n+\n+Presets can contain parameterized templates using `{{fragment_name:param}}` syntax. At resolution time, the fragment is looked up in the active profile and expanded with the parameter value.\n+\n+For example, the `rare` preset:\n+\n+```json\n+\"rare\": \"({{gnomad_af_below:0.0001}})\"\n+```\n+\n+expands to different SnpSift expressions depending on the active profile:\n+\n+- **dbnsfp4**: `(((dbNSFP_gnomAD_exomes_AF[0] < 0.0001) | ...) & ((dbNSFP_gnomAD_genomes_AF[0] < 0.0001) | ...))`\n+- **dbnsfp5**: `(((dbNSFP_gnomAD4.1_joint_AF[0] < 0.0001) | (na dbNSFP_gnomAD4.1_joint_AC[0])))`\n+\n+Presets without `{{...}}` patterns pass through unchanged (fully backward compatible).\n+\n+### Selecting a Profile\n+\n+Use the `--field-profile` CLI option:\n+\n+```bash\n+# Use dbNSFP v5.x field names\n+variantcentrifuge --field-profile dbnsfp5 --preset rare,coding ...\n+\n+# List available profiles\n+variantcentrifuge --list-field-profiles\n+```\n+\n+The default profile is set by `default_field_profile` in `config.json` (ships as `dbnsfp4`).\n+\n+### Profile Configuration Structure\n+\n+Profiles are defined in the `field_profiles` section of `config.json`:\n+\n+```json\n+{\n+  \"default_field_profile\": \"dbnsfp4\",\n+  \"field_profiles\": {\n+    \"dbnsfp4\": {\n+      \"description\": \"dbNSFP 4.x (separate gnomAD exomes/genomes fields)\",\n+      \"fragments\": {\n+        \"gnomad_af_below\": \"((dbNSFP_gnomAD_exomes_AF[0] < {0}) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AF[0] < {0}) | (na dbNSFP_gnomAD_genomes_AC[0]))\",\n+        \"gnomad_af_below_or\": \"((dbNSFP_gnomAD_exomes_AF[0] < {0}) | (na dbNSFP_gnomAD_exomes_AC[0])) | ((dbNSFP_gnomAD_genomes_AF[0] < {0}) | (na dbNSFP_gnomAD_genomes_AC[0]))\",\n+        \"gnomad_ac_atmost\": \"((dbNSFP_gnomAD_exomes_AC[0] <= {0}) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AC[0] <= {0}) | (na dbNSFP_gnomAD_genomes_AC[0]))\"\n+      },\n+      \"fields_to_extract\": \"dbNSFP_gnomAD_exomes_AF dbNSFP_gnomAD_genomes_AF dbNSFP_gnomAD_exomes_AC dbNSFP_gnomAD_genomes_AC\",\n+      \"hidden_columns\": [\"dbNSFP_gnomAD_exomes_AC\", \"dbNSFP_gnomAD_genomes_AC\"]\n+    },\n+    \"dbnsfp5\": {\n+      \"description\": \"dbNSFP 5.x (joint gnomAD 4.1 fields)\",\n+      \"fragments\": {\n+        \"gnomad_af_below\": \"((dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\",\n+        \"gnomad_af_below_or\": \"((dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\",\n+        \"gnomad_ac_atmost\": \"((dbNSFP_gnomAD4.1_joint_AC[0] <= {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\"\n+      },\n+      \"fields_to_extract\": \"dbNSFP_gnomAD4.1_joint_AF dbNSFP_gnomAD4.1_joint_AC\",\n+      \"hidden_columns\": [\"dbNSFP_gnomAD4.1_joint_AC\"]\n+    }\n+  }\n+}\n+```\n+\n+Each profile can define:\n+- **`fragments`** \u2014 Named templates with `{0}` placeholders for parameter substitution\n+- **`fields_to_extract`** \u2014 Profile-specific fields appended to the base field list\n+- **`hidden_columns`** \u2014 Columns hidden by default in HTML reports\n+\n+### Adding Custom Profiles\n+\n+To support a new annotation version, add a new profile to `field_profiles` in your config file with appropriate fragments. No code changes are needed \u2014 just define the fragment templates for your field naming convention.\n+\n ## Example Configurations\n \n ### Basic Research Configuration\ndiff --git a/docs/source/faq.md b/docs/source/faq.md\nindex b9db349..feca1e1 100644\n--- a/docs/source/faq.md\n+++ b/docs/source/faq.md\n@@ -37,7 +37,15 @@ Yes, VariantCentrifuge includes features specifically designed for clinical vari\n \n ### How do I install VariantCentrifuge?\n \n-The recommended installation method uses conda/mamba:\n+The quickest method is Docker, which includes all external tools:\n+\n+```bash\n+docker pull ghcr.io/scholl-lab/variantcentrifuge:latest\n+docker run --rm -v ./data:/data ghcr.io/scholl-lab/variantcentrifuge:latest \\\n+  --gene-name BRCA1 --vcf-file /data/input.vcf.gz --output-file /data/output.tsv\n+```\n+\n+For a native installation, use conda/mamba:\n \n ```bash\n # Create environment with dependencies\n@@ -252,3 +260,29 @@ variantcentrifuge \\\n ```\n \n This performs Fisher's exact test with multiple testing correction.\n+\n+### How do I switch between dbNSFP versions?\n+\n+Use the `--field-profile` option. The default profile (`dbnsfp4`) uses separate gnomAD exomes/genomes fields. For dbNSFP v5.x with joint gnomAD 4.1 fields, use `dbnsfp5`:\n+\n+```bash\n+variantcentrifuge --field-profile dbnsfp5 --preset rare,coding ...\n+```\n+\n+List available profiles:\n+```bash\n+variantcentrifuge --list-field-profiles\n+```\n+\n+See the [Field Profiles](configuration.md#field-profiles) documentation for details on adding custom profiles.\n+\n+### Can I run VariantCentrifuge without installing bioinformatics tools locally?\n+\n+Yes, the Docker image includes bcftools, snpEff, SnpSift, bedtools, and all Python dependencies. Mount your data directory and run:\n+\n+```bash\n+docker run --rm -v ./data:/data ghcr.io/scholl-lab/variantcentrifuge:latest \\\n+  --gene-name BRCA1 --vcf-file /data/input.vcf.gz --output-file /data/output.tsv\n+```\n+\n+See the [Docker installation guide](installation.md#method-4-docker-recommended-for-quick-setup) for complete setup instructions.\ndiff --git a/docs/source/installation.md b/docs/source/installation.md\nindex 63ebcde..297c956 100644\n--- a/docs/source/installation.md\n+++ b/docs/source/installation.md\n@@ -77,6 +77,49 @@ mamba activate annotation\n pip install -e .\n ```\n \n+### Method 4: Docker (Recommended for Quick Setup)\n+\n+The Docker image bundles all external tools (bcftools, snpEff, SnpSift, bedtools) and Python dependencies into a single container. No local installation of bioinformatics tools is required.\n+\n+```bash\n+# Pull the latest image from GitHub Container Registry\n+docker pull ghcr.io/scholl-lab/variantcentrifuge:latest\n+\n+# Verify the installation\n+docker run --rm ghcr.io/scholl-lab/variantcentrifuge:latest --version\n+```\n+\n+Place your VCF files in a local directory and mount it into the container:\n+\n+```bash\n+docker run --rm -v ./data:/data \\\n+  ghcr.io/scholl-lab/variantcentrifuge:latest \\\n+  --gene-name BRCA1 \\\n+  --vcf-file /data/input.vcf.gz \\\n+  --output-file /data/output.tsv\n+```\n+\n+A `docker-compose.yml` is included in the repository for convenience:\n+\n+```yaml\n+services:\n+  variantcentrifuge:\n+    image: ghcr.io/scholl-lab/variantcentrifuge:latest\n+    volumes:\n+      - ./data:/data\n+      # Mount snpEff databases (download once, reuse)\n+      # - /path/to/snpeff_data:/snpeff_data:ro\n+      # Override built-in scoring configs\n+      # - ./my_scoring:/app/scoring:ro\n+```\n+\n+```bash\n+docker compose run --rm variantcentrifuge \\\n+  --gene-name BRCA1 --vcf-file /data/input.vcf.gz --output-file /data/output.tsv\n+```\n+\n+The image runs as a non-root user, includes built-in scoring models at `/app/scoring/`, and is signed with cosign for supply chain security.\n+\n ## Verification\n \n Verify your installation by running:\ndiff --git a/docs/source/usage.md b/docs/source/usage.md\nindex 8d59b6b..fa03950 100644\n--- a/docs/source/usage.md\n+++ b/docs/source/usage.md\n@@ -35,6 +35,8 @@ variantcentrifuge \\\n - `--bcftools-prefilter \"EXPRESSION\"` - Apply bcftools pre-filter during variant extraction for performance\n - `--late-filtering` - Apply SnpSift filters after scoring and annotation (allows filtering on computed columns)\n - `--final-filter \"EXPRESSION\"` - Apply pandas query expression on final results (filter on any column including scores)\n+- `--field-profile PROFILE` - Select field profile for annotation database compatibility (e.g., `dbnsfp4`, `dbnsfp5`). See [Field Profiles](configuration.md#field-profiles)\n+- `--list-field-profiles` - List available field profiles and exit\n \n ### Input/Output Options\n \n@@ -237,6 +239,22 @@ variantcentrifuge \\\n   --output-dir previous_analysis/\n ```\n \n+### Docker\n+\n+All examples above work inside the Docker container by mounting your data directory:\n+\n+```bash\n+docker run --rm -v ./data:/data \\\n+  ghcr.io/scholl-lab/variantcentrifuge:latest \\\n+  --gene-name BRCA1 \\\n+  --vcf-file /data/input.vcf.gz \\\n+  --preset rare,coding \\\n+  --html-report \\\n+  --output-file /data/output.tsv\n+```\n+\n+See the [Installation Guide](installation.md#method-4-docker-recommended-for-quick-setup) for setup details.\n+\n ## Input File Formats\n \n ### VCF Files\ndiff --git a/scoring/nephro_candidate_score_v5/formula_config.json b/scoring/nephro_candidate_score_v5/formula_config.json\nnew file mode 100644\nindex 0000000..e1ea391\n--- /dev/null\n+++ b/scoring/nephro_candidate_score_v5/formula_config.json\n@@ -0,0 +1,33 @@\n+{\n+  \"output_scores\": [\n+    \"inheritance_score\",\n+    \"nephro_variant_score\",\n+    \"nephro_candidate_score\"\n+  ],\n+  \"formulas\": [\n+    {\n+      \"base_score\": \"(pattern == 'de_novo') * 0.95 + ((pattern == 'homozygous') | (pattern == 'compound_heterozygous') | (pattern == 'autosomal_recessive')) * 0.8 + (pattern == 'x_linked_recessive') * 0.7 + (pattern == 'x_linked_dominant') * 0.5 + (pattern == 'autosomal_dominant') * 0.4 + (pattern.str.contains('compound_heterozygous_possible')) * 0.4 + (pattern == 'unknown') * 0.1\"\n+    },\n+    {\n+      \"segregation_p_value\": \"details.str.extract(r'\\\"segregation_p_value\\\":\\\\s*([\\\\d.]+)', expand=False).astype('float')\"\n+    },\n+    {\n+      \"has_segregation\": \"~segregation_p_value.isna()\"\n+    },\n+    {\n+      \"penalized_patterns\": \"~pattern.isin(['de_novo', 'unknown', 'compound_heterozygous_possible_no_pedigree'])\"\n+    },\n+    {\n+      \"penalty_factor\": \"(segregation_p_value.isna() & penalized_patterns) * 0.2\"\n+    },\n+    {\n+      \"inheritance_score\": \"base_score * (1 - penalty_factor)\"\n+    },\n+    {\n+      \"nephro_variant_score\": \"1 / (1 + 2.718281828459045 ** (-((-36.30796) + ((gnomad_joint_variant - 0.00658) / 0.05959) * (-309.33539) + ((gnomad_joint_variant - 0.02425) / 0.11003) * (-2.54581) + (((consequence_terms_variant == 'missense_variant') * 1.0 - 0.24333) / 0.42909) * (-1.14313) + (((consequence_terms_variant == 'synonymous_variant') * 1.0 - 0.22931) / 0.42039) * (-0.96418) + (((consequence_terms_variant == 'stop_gained') * 1.0 - 0.06932) / 0.25400) * (-0.40553) + (((consequence_terms_variant.str.contains('frameshift', case=False, na=False)) * 1.0 - 0.13615) / 0.34295) * (0.90216) + ((cadd_phred_variant - 12.47608) / 11.78359) * 2.68520 + ((((impact_variant == 'HIGH') * 4 + (impact_variant == 'MODERATE') * 3 + (impact_variant == 'LOW') * 2 + (impact_variant == 'MODIFIER') * 1) - 2.49999) / 1.11804) * 3.14822)))\"\n+    },\n+    {\n+      \"nephro_candidate_score\": \"(nephro_variant_score * 4) + (nephro_gene_score * 4) + (inheritance_score * 2)\"\n+    }\n+  ]\n+}\ndiff --git a/scoring/nephro_candidate_score_v5/variable_assignment_config.json b/scoring/nephro_candidate_score_v5/variable_assignment_config.json\nnew file mode 100644\nindex 0000000..4c02889\n--- /dev/null\n+++ b/scoring/nephro_candidate_score_v5/variable_assignment_config.json\n@@ -0,0 +1,11 @@\n+{\n+  \"variables\": {\n+    \"dbNSFP_gnomAD4.1_joint_AF\": \"gnomad_joint_variant|default:0.0\",\n+    \"dbNSFP_CADD_phred\": \"cadd_phred_variant|default:0.0\",\n+    \"EFFECT\": \"consequence_terms_variant|default:''\",\n+    \"IMPACT\": \"impact_variant|default:''\",\n+    \"ngs\": \"nephro_gene_score|default:0.0\",\n+    \"Inheritance_Pattern\": \"pattern\",\n+    \"Inheritance_Details\": \"details\"\n+  }\n+}\ndiff --git a/variantcentrifuge/cli.py b/variantcentrifuge/cli.py\nindex 2893a2f..81e5a37 100644\n--- a/variantcentrifuge/cli.py\n+++ b/variantcentrifuge/cli.py\n@@ -150,6 +150,23 @@ def create_parser() -> argparse.ArgumentParser:\n             \"If custom filters are also given, they are combined with these presets using AND.\"\n         ),\n     )\n+    filter_group.add_argument(\n+        \"--field-profile\",\n+        help=(\n+            \"Field profile for annotation-version-specific field names \"\n+            \"(e.g., 'dbnsfp4', 'dbnsfp5'). Controls which gnomAD field names \"\n+            \"are used in filter presets and field extraction. \"\n+            \"Default: value of 'default_field_profile' in config (usually 'dbnsfp4'). \"\n+            \"Use --list-field-profiles to see available profiles.\"\n+        ),\n+        default=None,\n+    )\n+    filter_group.add_argument(\n+        \"--list-field-profiles\",\n+        action=\"store_true\",\n+        default=False,\n+        help=\"List available field profiles and exit.\",\n+    )\n     filter_group.add_argument(\n         \"--late-filtering\",\n         action=\"store_true\",\n@@ -726,6 +743,28 @@ def main() -> int:\n \n     parser = create_parser()\n \n+    # For --list-field-profiles, we don't need other required arguments\n+    if \"--list-field-profiles\" in sys.argv:\n+        from .field_profile import list_profiles\n+\n+        # Parse only the config argument (optional)\n+        profile_parser = argparse.ArgumentParser(description=\"List field profiles\")\n+        profile_parser.add_argument(\"--list-field-profiles\", action=\"store_true\")\n+        profile_parser.add_argument(\n+            \"-c\", \"--config\", help=\"Path to configuration file\", default=None\n+        )\n+        profile_args = profile_parser.parse_args()\n+\n+        profile_cfg = load_config(profile_args.config)\n+        profiles = list_profiles(profile_cfg)\n+        if profiles:\n+            print(\"Available field profiles:\")\n+            for prof in profiles:\n+                print(f\"  {prof['name']:12s}  {prof['description']}\")\n+        else:\n+            print(\"No field profiles defined in configuration.\")\n+        sys.exit(0)\n+\n     # For --show-checkpoint-status, we don't need other required arguments\n     if \"--show-checkpoint-status\" in sys.argv:\n         # Create a minimal parser just for checkpoint status\n@@ -804,6 +843,14 @@ def main() -> int:\n     cfg: dict[str, Any] = load_config(args.config)\n     logger.debug(f\"Configuration loaded: {cfg}\")\n \n+    # Resolve field profile (expands {{fragment:param}} templates in presets,\n+    # merges profile-specific fields and hidden columns into config)\n+    from .field_profile import resolve_profile\n+\n+    if args.field_profile:\n+        cfg[\"field_profile\"] = args.field_profile\n+    resolve_profile(cfg)\n+\n     reference: str | None = args.reference or cfg.get(\"reference\")\n     filters: str | None = args.filters or cfg.get(\"filters\")\n     fields: str | None = args.fields or cfg.get(\"fields_to_extract\")\ndiff --git a/variantcentrifuge/config.json b/variantcentrifuge/config.json\nindex 0208962..0c8245b 100644\n--- a/variantcentrifuge/config.json\n+++ b/variantcentrifuge/config.json\n@@ -2,7 +2,7 @@\n   \"reference\": \"GRCh37.p13\",\n   \"add_chr\": false,\n   \"filters\": \"\",\n-  \"fields_to_extract\": \"CHROM POS REF ALT ID FILTER QUAL AC ANN[0].GENE ANN[0].FEATUREID ANN[0].EFFECT ANN[0].IMPACT ANN[0].HGVS_C ANN[0].HGVS_P NMD[0].PERC ANN[0].AA_POS ANN[0].AA_LEN dbNSFP_REVEL_score dbNSFP_CADD_phred splice_dbscSNV_rf_score splice_dbscSNV_ada_score splice_spidex_dpsi_zscore dbNSFP_gnomAD_exomes_AC dbNSFP_gnomAD_genomes_AC dbNSFP_gnomAD_exomes_AF dbNSFP_gnomAD_genomes_AF dbNSFP_ALFA_Total_AC dbNSFP_clinvar_clnsig ClinVar_CLNSIG hgmd_CLASS GEN[*].GT\",\n+  \"fields_to_extract\": \"CHROM POS REF ALT ID FILTER QUAL AC ANN[0].GENE ANN[0].FEATUREID ANN[0].EFFECT ANN[0].IMPACT ANN[0].HGVS_C ANN[0].HGVS_P NMD[0].PERC ANN[0].AA_POS ANN[0].AA_LEN dbNSFP_REVEL_score dbNSFP_CADD_phred splice_dbscSNV_rf_score splice_dbscSNV_ada_score splice_spidex_dpsi_zscore dbNSFP_ALFA_Total_AC dbNSFP_clinvar_clnsig ClinVar_CLNSIG hgmd_CLASS GEN[*].GT\",\n   \"sample_file\": \"samples.txt\",\n   \"replace_script_options\": \"--append-genotype\",\n   \"output_file\": \"variants.tsv\",\n@@ -21,15 +21,39 @@\n   \"igv_hash_len_filename\": 6,\n   \"igv_max_variant_part_filename\": 50,\n \n+  \"default_field_profile\": \"dbnsfp4\",\n+  \"field_profiles\": {\n+    \"dbnsfp4\": {\n+      \"description\": \"dbNSFP v4.x (gnomAD v3/v4.0, separate exome+genome)\",\n+      \"fields_to_extract\": \"dbNSFP_gnomAD_exomes_AC dbNSFP_gnomAD_genomes_AC dbNSFP_gnomAD_exomes_AF dbNSFP_gnomAD_genomes_AF\",\n+      \"hidden_columns\": [\"dbNSFP_gnomAD_exomes_AC\", \"dbNSFP_gnomAD_genomes_AC\"],\n+      \"fragments\": {\n+        \"gnomad_af_below\": \"((dbNSFP_gnomAD_exomes_AF[0] < {0}) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AF[0] < {0}) | (na dbNSFP_gnomAD_genomes_AC[0]))\",\n+        \"gnomad_af_below_or\": \"(dbNSFP_gnomAD_exomes_AF[0] < {0}) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < {0}) | (na dbNSFP_gnomAD_genomes_AC[0])\",\n+        \"gnomad_ac_atmost\": \"((dbNSFP_gnomAD_exomes_AC[0] <= {0}) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AC[0] <= {0}) | (na dbNSFP_gnomAD_genomes_AC[0]))\"\n+      }\n+    },\n+    \"dbnsfp5\": {\n+      \"description\": \"dbNSFP v5.x (gnomAD v4.1, joint exome+genome)\",\n+      \"fields_to_extract\": \"dbNSFP_gnomAD4.1_joint_AC dbNSFP_gnomAD4.1_joint_AF\",\n+      \"hidden_columns\": [\"dbNSFP_gnomAD4.1_joint_AC\"],\n+      \"fragments\": {\n+        \"gnomad_af_below\": \"((dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\",\n+        \"gnomad_af_below_or\": \"(dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0])\",\n+        \"gnomad_ac_atmost\": \"((dbNSFP_gnomAD4.1_joint_AC[0] <= {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\"\n+      }\n+    }\n+  },\n+\n   \"presets\": {\n     \"pass\": \"(FILTER = 'PASS')\",\n     \"not_artefact\": \"((AC[ANY] <= 513) & (QUAL[ANY] >= 100))\",\n     \"not_benign\": \"(!(dbNSFP_clinvar_clnsig =~ '[Bb]enign') & !(ClinVar_CLNSIG =~ '[Bb]enign'))\",\n-    \"5percent_or_pathogenic\": \"(((dbNSFP_gnomAD_exomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_genomes_AC[0])) | (((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting'))))\",\n-    \"5percent\": \"(((dbNSFP_gnomAD_exomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_genomes_AC[0])))\",\n-    \"1percent\": \"(((dbNSFP_gnomAD_exomes_AF[0] < 0.001) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AF[0] < 0.001) | (na dbNSFP_gnomAD_genomes_AC[0])))\",\n-    \"rare\": \"(((dbNSFP_gnomAD_exomes_AF[0] < 0.0001) | (na dbNSFP_gnomAD_exomes_AC[0])) & ((dbNSFP_gnomAD_genomes_AF[0] < 0.0001) | (na dbNSFP_gnomAD_genomes_AC[0])))\",\n-    \"super_rare\": \"(((dbNSFP_gnomAD_exomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_exomes_AC[0])) & (( dbNSFP_gnomAD_genomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_genomes_AC[0])))\",\n+    \"5percent_or_pathogenic\": \"(({{gnomad_af_below_or:0.05}}) | (((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting'))))\",\n+    \"5percent\": \"({{gnomad_af_below:0.05}})\",\n+    \"1percent\": \"({{gnomad_af_below:0.001}})\",\n+    \"rare\": \"({{gnomad_af_below:0.0001}})\",\n+    \"super_rare\": \"({{gnomad_ac_atmost:2}})\",\n     \"pathogenic\": \"(((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting')))\",\n     \"coding\": \"((ANN[ANY].IMPACT has 'HIGH') | (ANN[ANY].IMPACT has 'MODERATE'))\",\n     \"high\": \"((ANN[ANY].IMPACT has 'HIGH'))\",\n@@ -44,10 +68,10 @@\n     \"modifier\": \"((ANN[ANY].IMPACT has 'MODIFIER'))\",\n     \"high_or_lof_or_nmd\": \"(((exists LOF[*].PERC) & (LOF[*].PERC > 0.9)) | ((exists NMD[*].PERC) & (NMD[*].PERC > 0.9)) | (ANN[ANY].IMPACT has 'HIGH')))\",\n     \"high_or_pathogenic\": \"(((ANN[ANY].IMPACT has 'HIGH') | (((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting'))))\",\n-    \"aif\": \"((((dbNSFP_gnomAD_exomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < 0.05) | (na dbNSFP_gnomAD_genomes_AC[0])) | (((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting')))) & ((((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting'))) | (((dbNSFP_gnomAD_exomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_genomes_AC[0])) & ((splice_spidex_dpsi_zscore <= -2.0 ) & (( splice_dbscSNV_ada_score >= 0.6 ) | ( splice_dbscSNV_rf_score >= 0.6 )))) | (((dbNSFP_gnomAD_exomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_genomes_AC[0])) & ((ANN[ANY].IMPACT has 'MODERATE') & ((dbNSFP_REVEL_score >= 0.9) | (dbNSFP_CADD_phred >= 30)))) | (((dbNSFP_gnomAD_exomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_exomes_AC[0]) | (dbNSFP_gnomAD_genomes_AF[0] < 0.01) | (na dbNSFP_gnomAD_genomes_AC[0])) & (((exists LOF[*].PERC) & (LOF[*].PERC > 0.9)) | ((exists NMD[*].PERC) & (NMD[*].PERC > 0.9)) | (ANN[ANY].IMPACT has 'HIGH')))))\",\n-    \"mutect2_TvsN_pass\": \"(((((dbNSFP_gnomAD_exomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_exomes_AC[0])) & (( dbNSFP_gnomAD_genomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_genomes_AC[0]))) | ((exists ID) & ( ID =~ 'COS' ))) & (( na FILTER ) | (FILTER = 'PASS')) & ( GEN[1].DP >= 50 ) & ((GEN[0].AF < 0.03) | (na GEN[0].AF)) & ( GEN[1].AF >= 0.05 ))\",\n-    \"mutect2_TvsN\": \"(((((dbNSFP_gnomAD_exomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_exomes_AC[0])) & (( dbNSFP_gnomAD_genomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_genomes_AC[0]))) | ((exists ID) & ( ID =~ 'COS' ))) & ( GEN[*].DP >= 50 ) & ((GEN[0].AF < 0.03) | (na GEN[0].AF)) & ( GEN[1].AF >= 0.05 ))\",\n-    \"mutect2_To_pass\": \"(((((dbNSFP_gnomAD_exomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_exomes_AC[0])) & (( dbNSFP_gnomAD_genomes_AC[0] <= 2 ) | (na dbNSFP_gnomAD_genomes_AC[0]))) | ((exists ID) & ( ID =~ 'COS' ))) & (( na FILTER ) | (FILTER = 'PASS')) & ( GEN[*].DP >= 50 ) & ( GEN[0].AF >= 0.05 ))\"\n+    \"aif\": \"((({{gnomad_af_below_or:0.05}}) | (((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting')))) & ((((dbNSFP_clinvar_clnsig =~ '[Pp]athogenic') & !(dbNSFP_clinvar_clnsig =~ '[Cc]onflicting')) | ((ClinVar_CLNSIG =~ '[Pp]athogenic') & !(ClinVar_CLNSIG =~ '[Cc]onflicting'))) | (({{gnomad_af_below_or:0.01}}) & ((splice_spidex_dpsi_zscore <= -2.0 ) & (( splice_dbscSNV_ada_score >= 0.6 ) | ( splice_dbscSNV_rf_score >= 0.6 )))) | (({{gnomad_af_below_or:0.01}}) & ((ANN[ANY].IMPACT has 'MODERATE') & ((dbNSFP_REVEL_score >= 0.9) | (dbNSFP_CADD_phred >= 30)))) | (({{gnomad_af_below_or:0.01}}) & (((exists LOF[*].PERC) & (LOF[*].PERC > 0.9)) | ((exists NMD[*].PERC) & (NMD[*].PERC > 0.9)) | (ANN[ANY].IMPACT has 'HIGH')))))\",\n+    \"mutect2_TvsN_pass\": \"((({{gnomad_ac_atmost:2}}) | ((exists ID) & ( ID =~ 'COS' ))) & (( na FILTER ) | (FILTER = 'PASS')) & ( GEN[1].DP >= 50 ) & ((GEN[0].AF < 0.03) | (na GEN[0].AF)) & ( GEN[1].AF >= 0.05 ))\",\n+    \"mutect2_TvsN\": \"((({{gnomad_ac_atmost:2}}) | ((exists ID) & ( ID =~ 'COS' ))) & ( GEN[*].DP >= 50 ) & ((GEN[0].AF < 0.03) | (na GEN[0].AF)) & ( GEN[1].AF >= 0.05 ))\",\n+    \"mutect2_To_pass\": \"((({{gnomad_ac_atmost:2}}) | ((exists ID) & ( ID =~ 'COS' ))) & (( na FILTER ) | (FILTER = 'PASS')) & ( GEN[*].DP >= 50 ) & ( GEN[0].AF >= 0.05 ))\"\n   },\n   \"links\": {\n     \"SpliceAI\": \"https://spliceailookup.broadinstitute.org/#variant={CHROM}-{POS}-{REF}-{ALT}&hg=19&bc=basic&distance=500&mask=0&ra=0\",\n@@ -70,8 +94,6 @@\n     \"splice_dbscSNV_ada_score\",\n     \"splice_spidex_dpsi_zscore\",\n     \"dbNSFP_clinvar_clnsig\",\n-    \"dbNSFP_gnomAD_exomes_AC\",\n-    \"dbNSFP_gnomAD_genomes_AC\",\n     \"hgmd_CLASS\",\n     \"proband_count\",\n     \"control_count\",\ndiff --git a/variantcentrifuge/field_profile.py b/variantcentrifuge/field_profile.py\nnew file mode 100644\nindex 0000000..a1e90c4\n--- /dev/null\n+++ b/variantcentrifuge/field_profile.py\n@@ -0,0 +1,157 @@\n+\"\"\"Field profile resolution for version-specific annotation field names.\n+\n+Field profiles handle differences between annotation database versions\n+(e.g., dbNSFP v4.x vs v5.x) by defining parameterized filter fragments\n+that get expanded at runtime based on the active profile.\n+\n+Presets use ``{{fragment_name:param}}`` syntax. At resolution time, the\n+fragment is looked up in the active profile and ``{0}`` placeholders in\n+the fragment template are replaced with the parameter value.\n+\n+Presets without ``{{...}}`` pass through unchanged (backward compatible).\n+\"\"\"\n+\n+import logging\n+import re\n+from typing import Any\n+\n+logger = logging.getLogger(\"variantcentrifuge\")\n+\n+# Matches {{fragment_name:param}} patterns in preset expressions.\n+# fragment_name: word chars (letters, digits, underscore)\n+# param: everything up to the closing }}\n+FRAGMENT_PATTERN = re.compile(r\"\\{\\{(\\w+):([^}]+)\\}\\}\")\n+\n+\n+def resolve_profile(config: dict[str, Any]) -> dict[str, Any]:\n+    \"\"\"Resolve field profile templates in config.\n+\n+    Expands ``{{fragment:param}}`` patterns in presets and merges\n+    profile-specific fields into ``fields_to_extract`` and\n+    ``html_report_default_hidden_columns``.\n+\n+    The active profile is determined by (in order of precedence):\n+    1. ``config[\"field_profile\"]`` (set by ``--field-profile`` CLI arg)\n+    2. ``config[\"default_field_profile\"]``\n+    3. Falls back to ``\"dbnsfp4\"``\n+\n+    Parameters\n+    ----------\n+    config : dict\n+        The full configuration dictionary (modified in place).\n+\n+    Returns\n+    -------\n+    dict\n+        The same config dict, with templates expanded and fields merged.\n+\n+    Raises\n+    ------\n+    ValueError\n+        If the requested profile is not found or a preset references\n+        an unknown fragment name.\n+    \"\"\"\n+    profiles = config.get(\"field_profiles\", {})\n+    if not profiles:\n+        # No profiles defined \u2014 nothing to resolve (backward compatible)\n+        return config\n+\n+    profile_name = config.get(\"field_profile\") or config.get(\"default_field_profile\", \"dbnsfp4\")\n+\n+    if profile_name not in profiles:\n+        available = \", \".join(sorted(profiles.keys())) or \"none defined\"\n+        raise ValueError(f\"Field profile '{profile_name}' not found. Available: {available}\")\n+\n+    profile = profiles[profile_name]\n+    fragments = profile.get(\"fragments\", {})\n+\n+    logger.debug(\"Resolving field profile '%s'\", profile_name)\n+\n+    # Expand templates in presets\n+    presets = config.get(\"presets\", {})\n+    for name, expr in presets.items():\n+        presets[name] = _expand_fragments(expr, fragments, name)\n+\n+    # Merge profile fields into fields_to_extract\n+    base_fields = config.get(\"fields_to_extract\", \"\")\n+    profile_fields = profile.get(\"fields_to_extract\", \"\")\n+    if profile_fields:\n+        config[\"fields_to_extract\"] = f\"{base_fields} {profile_fields}\".strip()\n+\n+    # Merge profile hidden columns\n+    base_hidden: list[str] = config.get(\"html_report_default_hidden_columns\", [])\n+    profile_hidden: list[str] = profile.get(\"hidden_columns\", [])\n+    for col in profile_hidden:\n+        if col not in base_hidden:\n+            base_hidden.append(col)\n+\n+    logger.debug(\n+        \"Profile '%s' resolved: %d fragments expanded, %d fields added, %d hidden columns added\",\n+        profile_name,\n+        len(fragments),\n+        len(profile_fields.split()) if profile_fields else 0,\n+        len(profile_hidden),\n+    )\n+\n+    return config\n+\n+\n+def _expand_fragments(expr: str, fragments: dict[str, str], preset_name: str) -> str:\n+    \"\"\"Replace all ``{{fragment_name:param}}`` patterns in an expression.\n+\n+    Parameters\n+    ----------\n+    expr : str\n+        The preset filter expression, possibly containing templates.\n+    fragments : dict\n+        Mapping of fragment name to template string with ``{0}`` placeholders.\n+    preset_name : str\n+        Name of the preset (used in error messages).\n+\n+    Returns\n+    -------\n+    str\n+        The expression with all templates expanded.\n+\n+    Raises\n+    ------\n+    ValueError\n+        If a referenced fragment name is not defined in the active profile.\n+    \"\"\"\n+\n+    def _replacer(match: re.Match[str]) -> str:\n+        frag_name = match.group(1)\n+        param = match.group(2)\n+        if frag_name not in fragments:\n+            raise ValueError(\n+                f\"Preset '{preset_name}' references unknown fragment \"\n+                f\"'{frag_name}'. Available fragments: \"\n+                f\"{', '.join(sorted(fragments.keys())) or 'none'}\"\n+            )\n+        return fragments[frag_name].replace(\"{0}\", param)\n+\n+    return FRAGMENT_PATTERN.sub(_replacer, expr)\n+\n+\n+def list_profiles(config: dict[str, Any]) -> list[dict[str, str]]:\n+    \"\"\"Return summary of available field profiles.\n+\n+    Parameters\n+    ----------\n+    config : dict\n+        The full configuration dictionary.\n+\n+    Returns\n+    -------\n+    list of dict\n+        Each dict has ``\"name\"`` and ``\"description\"`` keys.\n+    \"\"\"\n+    profiles = config.get(\"field_profiles\", {})\n+    default = config.get(\"default_field_profile\", \"dbnsfp4\")\n+    result = []\n+    for name, profile in profiles.items():\n+        desc = profile.get(\"description\", \"\")\n+        if name == default:\n+            desc = f\"{desc} [default]\" if desc else \"[default]\"\n+        result.append({\"name\": name, \"description\": desc})\n+    return result\n",
  "test_patch": "diff --git a/tests/test_cli.py b/tests/test_cli.py\nindex 301a5e0..be5eb71 100644\n--- a/tests/test_cli.py\n+++ b/tests/test_cli.py\n@@ -653,10 +653,12 @@ class TestCLIRegressionTests:\n \n         # Verify main() has minimal parser-related code\n         parser_creation_count = main_source.count(\"ArgumentParser\")\n-        # main() should only create the status_parser for --show-checkpoint-status\n-        assert parser_creation_count <= 1, (\n+        # main() creates mini-parsers for early-exit flags:\n+        # - status_parser for --show-checkpoint-status\n+        # - profile_parser for --list-field-profiles\n+        assert parser_creation_count <= 2, (\n             f\"main() creates too many ArgumentParsers ({parser_creation_count}). \"\n-            f\"Should only create status_parser for --show-checkpoint-status.\"\n+            f\"Expected at most 2 (status_parser + profile_parser).\"\n         )\n \n \n@@ -1010,3 +1012,91 @@ class TestPerformanceConfigMapping:\n             should_warn = True\n \n         assert should_warn, \"Should warn when pseudonymize_table provided without pseudonymize\"\n+\n+\n+class TestFieldProfileCLI:\n+    \"\"\"Tests for --field-profile and --list-field-profiles CLI arguments.\"\"\"\n+\n+    def test_field_profile_arg_in_help(self):\n+        \"\"\"Test that --field-profile appears in help text.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        help_text = parser.format_help()\n+        assert \"--field-profile\" in help_text\n+\n+    def test_list_field_profiles_arg_in_help(self):\n+        \"\"\"Test that --list-field-profiles appears in help text.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        help_text = parser.format_help()\n+        assert \"--list-field-profiles\" in help_text\n+\n+    def test_field_profile_parses(self):\n+        \"\"\"Test that --field-profile parses correctly.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        args = parser.parse_args([\"--vcf-file\", \"test.vcf\", \"--field-profile\", \"dbnsfp5\"])\n+        assert args.field_profile == \"dbnsfp5\"\n+\n+    def test_field_profile_default_none(self):\n+        \"\"\"Test that --field-profile defaults to None.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        args = parser.parse_args([\"--vcf-file\", \"test.vcf\"])\n+        assert args.field_profile is None\n+\n+    def test_list_field_profiles_default_false(self):\n+        \"\"\"Test that --list-field-profiles defaults to False.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        args = parser.parse_args([\"--vcf-file\", \"test.vcf\"])\n+        assert args.list_field_profiles is False\n+\n+    def test_list_field_profiles_flag(self):\n+        \"\"\"Test that --list-field-profiles sets the flag.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        args = parser.parse_args([\"--vcf-file\", \"test.vcf\", \"--list-field-profiles\"])\n+        assert args.list_field_profiles is True\n+\n+    def test_list_field_profiles_early_exit(self):\n+        \"\"\"Test that --list-field-profiles exits without requiring --vcf-file.\"\"\"\n+        from unittest.mock import patch\n+\n+        with (\n+            patch(\"sys.argv\", [\"variantcentrifuge\", \"--list-field-profiles\"]),\n+            patch(\"builtins.print\") as mock_print,\n+        ):\n+            with pytest.raises(SystemExit) as exc_info:\n+                from variantcentrifuge.cli import main\n+\n+                main()\n+\n+            assert exc_info.value.code == 0\n+            print_calls = [str(call) for call in mock_print.call_args_list]\n+            full_output = \" \".join(print_calls)\n+            assert \"dbnsfp4\" in full_output\n+            assert \"dbnsfp5\" in full_output\n+\n+    def test_field_profile_in_filtering_group(self):\n+        \"\"\"Test that --field-profile is in the Filtering & Annotation group.\"\"\"\n+        from variantcentrifuge.cli import create_parser\n+\n+        parser = create_parser()\n+        # Find the Filtering & Annotation group\n+        filter_group = None\n+        for group in parser._action_groups:\n+            if group.title == \"Filtering & Annotation\":\n+                filter_group = group\n+                break\n+        assert filter_group is not None\n+        action_names = [a.option_strings for a in filter_group._group_actions]\n+        flat_names = [name for names in action_names for name in names]\n+        assert \"--field-profile\" in flat_names\n+        assert \"--list-field-profiles\" in flat_names\ndiff --git a/tests/test_cli_argument_parsing.py b/tests/test_cli_argument_parsing.py\nindex 1b164cc..fa390b4 100644\n--- a/tests/test_cli_argument_parsing.py\n+++ b/tests/test_cli_argument_parsing.py\n@@ -170,11 +170,13 @@ class TestArgumentParserArchitecture:\n             f\"main() should call create_parser() exactly once, found {create_parser_calls}\"\n         )\n \n-        # main() should create minimal additional parsers (only status_parser)\n+        # main() should create minimal additional parsers for early-exit flags:\n+        # - status_parser for --show-checkpoint-status\n+        # - profile_parser for --list-field-profiles\n         parser_creations = main_source.count(\"ArgumentParser\")\n-        assert parser_creations <= 1, (\n-            f\"main() should create at most 1 ArgumentParser (status_parser), \"\n-            f\"found {parser_creations}\"\n+        assert parser_creations <= 2, (\n+            f\"main() should create at most 2 ArgumentParsers \"\n+            f\"(status_parser + profile_parser), found {parser_creations}\"\n         )\n \n     def test_argument_groups_only_in_create_parser(self):\ndiff --git a/tests/unit/pipeline/test_runner.py b/tests/unit/pipeline/test_runner.py\nindex 400e6a4..dcb140e 100644\n--- a/tests/unit/pipeline/test_runner.py\n+++ b/tests/unit/pipeline/test_runner.py\n@@ -180,34 +180,6 @@ class TestPipelineRunner:\n         assert stages[1].executed\n         assert not stages[2].executed  # Should not execute after failure\n \n-    @pytest.mark.xfail(reason=\"ThreadPoolExecutor doesn't support true task cancellation\")\n-    def test_parallel_failure_cancellation(self, runner, context):\n-        \"\"\"Test that parallel stages are cancelled on failure.\"\"\"\n-\n-        # Create a stage that checks cancellation\n-        class CancellableStage(MockStage):\n-            def _process(self, context):\n-                # Sleep in small increments to allow cancellation\n-                for _ in range(50):  # 5 seconds total\n-                    time.sleep(0.1)\n-                self.executed = True\n-                context.mark_complete(self.name)\n-                return context\n-\n-        stages = [\n-            CancellableStage(\"slow\", parallel_safe=True),\n-            MockStage(\"fast_fail\", parallel_safe=True, runtime=0.1, should_fail=True),\n-        ]\n-\n-        start_time = time.time()\n-        with pytest.raises(ValueError):\n-            runner.run(stages, context)\n-        elapsed = time.time() - start_time\n-\n-        # Should fail quickly, not wait for slow stage\n-        # Allow some extra time for overhead\n-        assert elapsed < 2.0  # Increased threshold for reliability\n-\n     def test_execution_plan_creation(self, runner):\n         \"\"\"Test execution plan creation.\"\"\"\n         stages = [\ndiff --git a/tests/unit/test_field_profile.py b/tests/unit/test_field_profile.py\nnew file mode 100644\nindex 0000000..9a18769\n--- /dev/null\n+++ b/tests/unit/test_field_profile.py\n@@ -0,0 +1,452 @@\n+\"\"\"Tests for the field_profile module.\n+\n+Tests cover fragment expansion, profile resolution, error handling,\n+backward compatibility, and the list_profiles helper.\n+\"\"\"\n+\n+import pytest\n+\n+from variantcentrifuge.field_profile import (\n+    FRAGMENT_PATTERN,\n+    _expand_fragments,\n+    list_profiles,\n+    resolve_profile,\n+)\n+\n+# ---------------------------------------------------------------------------\n+# Fixtures\n+# ---------------------------------------------------------------------------\n+\n+\n+@pytest.fixture()\n+def dbnsfp4_config():\n+    \"\"\"Minimal config with dbnsfp4 and dbnsfp5 profiles.\"\"\"\n+    return {\n+        \"default_field_profile\": \"dbnsfp4\",\n+        \"field_profiles\": {\n+            \"dbnsfp4\": {\n+                \"description\": \"dbNSFP v4.x (separate exome+genome)\",\n+                \"fields_to_extract\": \"dbNSFP_gnomAD_exomes_AF dbNSFP_gnomAD_genomes_AF\",\n+                \"hidden_columns\": [\"dbNSFP_gnomAD_exomes_AC\"],\n+                \"fragments\": {\n+                    \"gnomad_af_below\": (\n+                        \"((dbNSFP_gnomAD_exomes_AF[0] < {0}) \"\n+                        \"| (na dbNSFP_gnomAD_exomes_AC[0])) \"\n+                        \"& ((dbNSFP_gnomAD_genomes_AF[0] < {0}) \"\n+                        \"| (na dbNSFP_gnomAD_genomes_AC[0]))\"\n+                    ),\n+                    \"gnomad_af_below_or\": (\n+                        \"(dbNSFP_gnomAD_exomes_AF[0] < {0}) \"\n+                        \"| (na dbNSFP_gnomAD_exomes_AC[0]) \"\n+                        \"| (dbNSFP_gnomAD_genomes_AF[0] < {0}) \"\n+                        \"| (na dbNSFP_gnomAD_genomes_AC[0])\"\n+                    ),\n+                    \"gnomad_ac_atmost\": (\n+                        \"((dbNSFP_gnomAD_exomes_AC[0] <= {0}) \"\n+                        \"| (na dbNSFP_gnomAD_exomes_AC[0])) \"\n+                        \"& ((dbNSFP_gnomAD_genomes_AC[0] <= {0}) \"\n+                        \"| (na dbNSFP_gnomAD_genomes_AC[0]))\"\n+                    ),\n+                },\n+            },\n+            \"dbnsfp5\": {\n+                \"description\": \"dbNSFP v5.x (joint exome+genome)\",\n+                \"fields_to_extract\": \"dbNSFP_gnomAD4.1_joint_AF\",\n+                \"hidden_columns\": [\"dbNSFP_gnomAD4.1_joint_AC\"],\n+                \"fragments\": {\n+                    \"gnomad_af_below\": (\n+                        \"((dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0]))\"\n+                    ),\n+                    \"gnomad_af_below_or\": (\n+                        \"(dbNSFP_gnomAD4.1_joint_AF[0] < {0}) | (na dbNSFP_gnomAD4.1_joint_AC[0])\"\n+                    ),\n+                    \"gnomad_ac_atmost\": (\n+                        \"((dbNSFP_gnomAD4.1_joint_AC[0] <= {0}) \"\n+                        \"| (na dbNSFP_gnomAD4.1_joint_AC[0]))\"\n+                    ),\n+                },\n+            },\n+        },\n+        \"fields_to_extract\": \"CHROM POS REF ALT\",\n+        \"html_report_default_hidden_columns\": [\"QUAL\", \"AC\"],\n+        \"presets\": {\n+            \"rare\": \"({{gnomad_af_below:0.0001}})\",\n+            \"coding\": \"((ANN[ANY].IMPACT has 'HIGH'))\",\n+            \"super_rare\": \"({{gnomad_ac_atmost:2}})\",\n+            \"mixed\": \"(({{gnomad_af_below_or:0.05}}) | (pathogenic))\",\n+        },\n+    }\n+\n+\n+# ---------------------------------------------------------------------------\n+# FRAGMENT_PATTERN regex tests\n+# ---------------------------------------------------------------------------\n+\n+\n+class TestFragmentPattern:\n+    \"\"\"Tests for the FRAGMENT_PATTERN regex.\"\"\"\n+\n+    def test_matches_simple_fragment(self):\n+        match = FRAGMENT_PATTERN.search(\"({{gnomad_af_below:0.05}})\")\n+        assert match is not None\n+        assert match.group(1) == \"gnomad_af_below\"\n+        assert match.group(2) == \"0.05\"\n+\n+    def test_matches_integer_param(self):\n+        match = FRAGMENT_PATTERN.search(\"({{gnomad_ac_atmost:2}})\")\n+        assert match is not None\n+        assert match.group(1) == \"gnomad_ac_atmost\"\n+        assert match.group(2) == \"2\"\n+\n+    def test_matches_multiple_fragments(self):\n+        text = \"(({{frag1:a}}) & ({{frag2:b}}))\"\n+        matches = FRAGMENT_PATTERN.findall(text)\n+        assert len(matches) == 2\n+        assert matches[0] == (\"frag1\", \"a\")\n+        assert matches[1] == (\"frag2\", \"b\")\n+\n+    def test_no_match_plain_text(self):\n+        assert FRAGMENT_PATTERN.search(\"no templates here\") is None\n+\n+    def test_no_match_single_braces(self):\n+        assert FRAGMENT_PATTERN.search(\"{not_a_template:val}\") is None\n+\n+\n+# ---------------------------------------------------------------------------\n+# _expand_fragments tests\n+# ---------------------------------------------------------------------------\n+\n+\n+class TestExpandFragments:\n+    \"\"\"Tests for the _expand_fragments function.\"\"\"\n+\n+    def test_single_fragment(self):\n+        fragments = {\"af\": \"AF < {0}\"}\n+        result = _expand_fragments(\"({{af:0.01}})\", fragments, \"test\")\n+        assert result == \"(AF < 0.01)\"\n+\n+    def test_multiple_fragments(self):\n+        fragments = {\"af\": \"AF < {0}\", \"ac\": \"AC <= {0}\"}\n+        result = _expand_fragments(\"({{af:0.01}}) & ({{ac:5}})\", fragments, \"test\")\n+        assert result == \"(AF < 0.01) & (AC <= 5)\"\n+\n+    def test_same_fragment_different_params(self):\n+        fragments = {\"af\": \"AF < {0}\"}\n+        result = _expand_fragments(\"({{af:0.05}}) | ({{af:0.01}})\", fragments, \"test\")\n+        assert result == \"(AF < 0.05) | (AF < 0.01)\"\n+\n+    def test_no_fragments(self):\n+        fragments = {\"af\": \"AF < {0}\"}\n+        expr = \"((ANN[ANY].IMPACT has 'HIGH'))\"\n+        result = _expand_fragments(expr, fragments, \"test\")\n+        assert result == expr\n+\n+    def test_unknown_fragment_raises(self):\n+        fragments = {\"af\": \"AF < {0}\"}\n+        with pytest.raises(ValueError, match=\"unknown fragment 'missing'\"):\n+            _expand_fragments(\"({{missing:0.01}})\", fragments, \"test\")\n+\n+    def test_unknown_fragment_error_includes_preset_name(self):\n+        fragments = {}\n+        with pytest.raises(ValueError, match=\"Preset 'rare'\"):\n+            _expand_fragments(\"({{af:0.01}})\", fragments, \"rare\")\n+\n+    def test_param_with_decimal(self):\n+        fragments = {\"af\": \"AF[0] < {0}\"}\n+        result = _expand_fragments(\"({{af:0.0001}})\", fragments, \"test\")\n+        assert result == \"(AF[0] < 0.0001)\"\n+\n+    def test_multiple_placeholders_in_fragment(self):\n+        \"\"\"A single {0} placeholder used twice in the template.\"\"\"\n+        fragments = {\"dual\": \"(A < {0}) & (B < {0})\"}\n+        result = _expand_fragments(\"({{dual:0.05}})\", fragments, \"test\")\n+        assert result == \"((A < 0.05) & (B < 0.05))\"\n+\n+\n+# ---------------------------------------------------------------------------\n+# resolve_profile tests\n+# ---------------------------------------------------------------------------\n+\n+\n+class TestResolveProfile:\n+    \"\"\"Tests for the resolve_profile function.\"\"\"\n+\n+    def test_default_profile_dbnsfp4(self, dbnsfp4_config):\n+        result = resolve_profile(dbnsfp4_config)\n+        assert result is dbnsfp4_config  # mutates in place\n+\n+        # Presets should be expanded with dbnsfp4 fragments\n+        assert \"dbNSFP_gnomAD_exomes_AF\" in result[\"presets\"][\"rare\"]\n+        assert \"dbNSFP_gnomAD_genomes_AF\" in result[\"presets\"][\"rare\"]\n+        assert \"{{\" not in result[\"presets\"][\"rare\"]\n+\n+    def test_explicit_profile_dbnsfp5(self, dbnsfp4_config):\n+        dbnsfp4_config[\"field_profile\"] = \"dbnsfp5\"\n+        result = resolve_profile(dbnsfp4_config)\n+\n+        # Presets should be expanded with dbnsfp5 fragments\n+        assert \"dbNSFP_gnomAD4.1_joint_AF\" in result[\"presets\"][\"rare\"]\n+        assert \"dbNSFP_gnomAD_exomes_AF\" not in result[\"presets\"][\"rare\"]\n+        assert \"{{\" not in result[\"presets\"][\"rare\"]\n+\n+    def test_non_template_preset_unchanged(self, dbnsfp4_config):\n+        resolve_profile(dbnsfp4_config)\n+        assert dbnsfp4_config[\"presets\"][\"coding\"] == \"((ANN[ANY].IMPACT has 'HIGH'))\"\n+\n+    def test_fields_merged(self, dbnsfp4_config):\n+        resolve_profile(dbnsfp4_config)\n+        fields = dbnsfp4_config[\"fields_to_extract\"]\n+        assert \"CHROM\" in fields\n+        assert \"dbNSFP_gnomAD_exomes_AF\" in fields\n+        assert \"dbNSFP_gnomAD_genomes_AF\" in fields\n+\n+    def test_fields_merged_dbnsfp5(self, dbnsfp4_config):\n+        dbnsfp4_config[\"field_profile\"] = \"dbnsfp5\"\n+        resolve_profile(dbnsfp4_config)\n+        fields = dbnsfp4_config[\"fields_to_extract\"]\n+        assert \"CHROM\" in fields\n+        assert \"dbNSFP_gnomAD4.1_joint_AF\" in fields\n+        assert \"dbNSFP_gnomAD_exomes_AF\" not in fields\n+\n+    def test_hidden_columns_merged(self, dbnsfp4_config):\n+        resolve_profile(dbnsfp4_config)\n+        hidden = dbnsfp4_config[\"html_report_default_hidden_columns\"]\n+        assert \"QUAL\" in hidden  # base\n+        assert \"dbNSFP_gnomAD_exomes_AC\" in hidden  # profile\n+\n+    def test_hidden_columns_no_duplicates(self, dbnsfp4_config):\n+        # Pre-populate with a profile column to verify no duplicate\n+        dbnsfp4_config[\"html_report_default_hidden_columns\"].append(\"dbNSFP_gnomAD_exomes_AC\")\n+        resolve_profile(dbnsfp4_config)\n+        hidden = dbnsfp4_config[\"html_report_default_hidden_columns\"]\n+        assert hidden.count(\"dbNSFP_gnomAD_exomes_AC\") == 1\n+\n+    def test_missing_profile_raises(self, dbnsfp4_config):\n+        dbnsfp4_config[\"field_profile\"] = \"nonexistent\"\n+        with pytest.raises(ValueError, match=\"not found\"):\n+            resolve_profile(dbnsfp4_config)\n+\n+    def test_missing_profile_lists_available(self, dbnsfp4_config):\n+        dbnsfp4_config[\"field_profile\"] = \"nonexistent\"\n+        with pytest.raises(ValueError, match=\"dbnsfp4\"):\n+            resolve_profile(dbnsfp4_config)\n+\n+    def test_no_profiles_section_passthrough(self):\n+        \"\"\"Config without field_profiles should pass through unchanged.\"\"\"\n+        cfg = {\n+            \"presets\": {\"rare\": \"(AF < 0.01)\"},\n+            \"fields_to_extract\": \"CHROM POS\",\n+        }\n+        original_presets = cfg[\"presets\"].copy()\n+        resolve_profile(cfg)\n+        assert cfg[\"presets\"] == original_presets\n+\n+    def test_empty_profiles_section_passthrough(self):\n+        \"\"\"Config with empty field_profiles should pass through unchanged.\"\"\"\n+        cfg = {\n+            \"field_profiles\": {},\n+            \"presets\": {\"rare\": \"(AF < 0.01)\"},\n+            \"fields_to_extract\": \"CHROM POS\",\n+        }\n+        original_presets = cfg[\"presets\"].copy()\n+        resolve_profile(cfg)\n+        assert cfg[\"presets\"] == original_presets\n+\n+    def test_profile_with_empty_fields(self):\n+        \"\"\"Profile with empty fields_to_extract should not add trailing space.\"\"\"\n+        cfg = {\n+            \"default_field_profile\": \"minimal\",\n+            \"field_profiles\": {\n+                \"minimal\": {\n+                    \"description\": \"Minimal profile\",\n+                    \"fields_to_extract\": \"\",\n+                    \"hidden_columns\": [],\n+                    \"fragments\": {},\n+                },\n+            },\n+            \"fields_to_extract\": \"CHROM POS\",\n+            \"html_report_default_hidden_columns\": [],\n+            \"presets\": {},\n+        }\n+        resolve_profile(cfg)\n+        assert cfg[\"fields_to_extract\"] == \"CHROM POS\"\n+\n+    def test_mixed_preset_expansion(self, dbnsfp4_config):\n+        \"\"\"Mixed preset with template and non-template parts.\"\"\"\n+        resolve_profile(dbnsfp4_config)\n+        mixed = dbnsfp4_config[\"presets\"][\"mixed\"]\n+        assert \"dbNSFP_gnomAD_exomes_AF\" in mixed\n+        assert \"(pathogenic)\" in mixed\n+        assert \"{{\" not in mixed\n+\n+\n+class TestResolveProfileWithRealConfig:\n+    \"\"\"Tests using the actual config.json to verify backward compatibility.\"\"\"\n+\n+    def test_load_and_resolve_default_profile(self):\n+        \"\"\"Default profile resolution produces valid expanded presets.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        # All template markers should be expanded\n+        for name, expr in cfg[\"presets\"].items():\n+            assert \"{{\" not in expr, f\"Preset '{name}' still has unexpanded templates\"\n+\n+    def test_default_profile_rare_preset_structure(self):\n+        \"\"\"The 'rare' preset under dbnsfp4 has the expected gnomAD fields.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        rare = cfg[\"presets\"][\"rare\"]\n+        assert \"dbNSFP_gnomAD_exomes_AF[0] < 0.0001\" in rare\n+        assert \"dbNSFP_gnomAD_genomes_AF[0] < 0.0001\" in rare\n+        assert \"na dbNSFP_gnomAD_exomes_AC[0]\" in rare\n+\n+    def test_dbnsfp5_rare_preset_structure(self):\n+        \"\"\"The 'rare' preset under dbnsfp5 has joint gnomAD fields.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        cfg[\"field_profile\"] = \"dbnsfp5\"\n+        resolve_profile(cfg)\n+\n+        rare = cfg[\"presets\"][\"rare\"]\n+        assert \"dbNSFP_gnomAD4.1_joint_AF[0] < 0.0001\" in rare\n+        assert \"dbNSFP_gnomAD_exomes_AF\" not in rare\n+\n+    def test_default_profile_fields_include_gnomad(self):\n+        \"\"\"Default profile fields include gnomAD exome/genome fields.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        fields = cfg[\"fields_to_extract\"]\n+        assert \"dbNSFP_gnomAD_exomes_AF\" in fields\n+        assert \"dbNSFP_gnomAD_genomes_AF\" in fields\n+        assert \"dbNSFP_gnomAD_exomes_AC\" in fields\n+        assert \"dbNSFP_gnomAD_genomes_AC\" in fields\n+\n+    def test_dbnsfp5_profile_fields_include_joint(self):\n+        \"\"\"dbnsfp5 profile fields include joint gnomAD fields.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        cfg[\"field_profile\"] = \"dbnsfp5\"\n+        resolve_profile(cfg)\n+\n+        fields = cfg[\"fields_to_extract\"]\n+        assert \"dbNSFP_gnomAD4.1_joint_AF\" in fields\n+        assert \"dbNSFP_gnomAD4.1_joint_AC\" in fields\n+        assert \"dbNSFP_gnomAD_exomes_AF\" not in fields\n+\n+    def test_default_profile_hidden_columns(self):\n+        \"\"\"Default profile adds gnomAD AC columns to hidden list.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        hidden = cfg[\"html_report_default_hidden_columns\"]\n+        assert \"dbNSFP_gnomAD_exomes_AC\" in hidden\n+        assert \"dbNSFP_gnomAD_genomes_AC\" in hidden\n+\n+    def test_all_presets_have_balanced_parens(self):\n+        \"\"\"Expanded presets with templates should have balanced parentheses.\n+\n+        Note: Some presets have pre-existing unbalanced parentheses that are\n+        not caused by the field profile system. These are excluded here.\n+        \"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        # Pre-existing paren issues (not from field profiles, not template presets)\n+        known_unbalanced = {\n+            \"moderate_and_high_prediction\",\n+            \"high_or_lof_or_nmd\",\n+            \"high_or_pathogenic\",\n+        }\n+\n+        for name, expr in cfg[\"presets\"].items():\n+            if name in known_unbalanced:\n+                continue\n+            open_count = expr.count(\"(\")\n+            close_count = expr.count(\")\")\n+            assert open_count == close_count, (\n+                f\"Preset '{name}' has unbalanced parentheses: \"\n+                f\"{open_count} open, {close_count} close\"\n+            )\n+\n+    def test_mutect2_preset_expansion(self):\n+        \"\"\"mutect2 presets expand gnomAD AC fragments correctly.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        for preset_name in (\"mutect2_TvsN_pass\", \"mutect2_TvsN\", \"mutect2_To_pass\"):\n+            expr = cfg[\"presets\"][preset_name]\n+            assert \"dbNSFP_gnomAD_exomes_AC[0] <= 2\" in expr\n+            assert \"dbNSFP_gnomAD_genomes_AC[0] <= 2\" in expr\n+            assert \"{{\" not in expr\n+\n+    def test_aif_preset_expansion(self):\n+        \"\"\"aif preset expands both 0.05 and 0.01 gnomAD OR fragments.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        resolve_profile(cfg)\n+\n+        aif = cfg[\"presets\"][\"aif\"]\n+        assert \"dbNSFP_gnomAD_exomes_AF[0] < 0.05\" in aif\n+        assert \"dbNSFP_gnomAD_exomes_AF[0] < 0.01\" in aif\n+        assert \"{{\" not in aif\n+\n+\n+# ---------------------------------------------------------------------------\n+# list_profiles tests\n+# ---------------------------------------------------------------------------\n+\n+\n+class TestListProfiles:\n+    \"\"\"Tests for the list_profiles function.\"\"\"\n+\n+    def test_list_profiles(self, dbnsfp4_config):\n+        profiles = list_profiles(dbnsfp4_config)\n+        assert len(profiles) == 2\n+        names = {p[\"name\"] for p in profiles}\n+        assert names == {\"dbnsfp4\", \"dbnsfp5\"}\n+\n+    def test_default_profile_marked(self, dbnsfp4_config):\n+        profiles = list_profiles(dbnsfp4_config)\n+        default = next(p for p in profiles if p[\"name\"] == \"dbnsfp4\")\n+        assert \"[default]\" in default[\"description\"]\n+\n+    def test_non_default_profile_not_marked(self, dbnsfp4_config):\n+        profiles = list_profiles(dbnsfp4_config)\n+        other = next(p for p in profiles if p[\"name\"] == \"dbnsfp5\")\n+        assert \"[default]\" not in other[\"description\"]\n+\n+    def test_empty_profiles(self):\n+        profiles = list_profiles({\"field_profiles\": {}})\n+        assert profiles == []\n+\n+    def test_no_profiles_key(self):\n+        profiles = list_profiles({})\n+        assert profiles == []\n+\n+    def test_list_profiles_from_real_config(self):\n+        \"\"\"Real config should have at least dbnsfp4 and dbnsfp5.\"\"\"\n+        from variantcentrifuge.config import load_config\n+\n+        cfg = load_config()\n+        profiles = list_profiles(cfg)\n+        names = {p[\"name\"] for p in profiles}\n+        assert \"dbnsfp4\" in names\n+        assert \"dbnsfp5\" in names\n",
  "hints_text": "",
  "environment_setup_commit": "7f8ecef800e72e3197b223faa020fb2231f212bb",
  "install_config": {},
  "meta": {
    "commit_name": "head_commit",
    "num_modified_files": 11,
    "has_test_patch": true,
    "is_lite": false,
    "llm_score": {
      "difficulty_score": null,
      "issue_text_score": null,
      "test_score": null
    }
  },
  "license_name": "MIT",
  "FAIL_TO_PASS": [],
  "PASS_TO_PASS": [],
  "requirements": "",
  "environment": ""
}