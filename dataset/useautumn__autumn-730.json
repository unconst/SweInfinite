{
  "instance_id": "useautumn__autumn-730",
  "repo": "useautumn/autumn",
  "base_commit": "e61d4fd83b4c74ada22c60600606f0f19386639f",
  "version": "unknown",
  "created_at": "2026-02-13T22:53:55.170399+00:00",
  "problem_statement": "Based on the PR description and diff, here's a concise problem statement:\n\n---\n\n**Problem Statement:**\n\nThe subscription preview change detection incorrectly flags `ProductItem` entries as modified when no user-visible changes occurred. The `hasItemChanged` function compares internal/metadata fields (e.g., `feature_id`, `price_id`, `usage_limit`) that change without user action, causing false positives. It also treats `undefined` and `null` differently and doesn't normalize object key ordering, so structurally equivalent items appear different. As a result, the preview shows items as \"modified\" even when only backend metadata changed or the data was formatted differently, misleading users about what actually changed in their subscription.\n\n---",
  "patch": "diff --git a/server/src/_luaScriptsV2/deleteFullCustomerCache/setFullCustomerCache.lua b/server/src/_luaScriptsV2/deleteFullCustomerCache/setFullCustomerCache.lua\nindex d563599b..b84d8b2a 100644\n--- a/server/src/_luaScriptsV2/deleteFullCustomerCache/setFullCustomerCache.lua\n+++ b/server/src/_luaScriptsV2/deleteFullCustomerCache/setFullCustomerCache.lua\n@@ -30,15 +30,15 @@ local cacheTtl = tonumber(ARGV[2])\n local serializedData = ARGV[3]\n local overwrite = ARGV[4] == \"true\"\n \n--- -- Check if guard exists (deletion happened recently)\n--- -- Skip check if either value is nil/null/falsey\n--- local guardTime = redis.call(\"GET\", guardKey)\n--- if guardTime and guardTime ~= cjson.null and fetchTimeMs then\n---     local guardTimeNum = tonumber(guardTime)\n---     if guardTimeNum and guardTimeNum > fetchTimeMs then\n---         return \"STALE_WRITE\"\n---     end\n--- end\n+-- Check if guard exists (deletion happened recently)\n+-- Skip check if either value is nil/null/falsey\n+local guardTime = redis.call(\"GET\", guardKey)\n+if guardTime and guardTime ~= cjson.null and fetchTimeMs then\n+    local guardTimeNum = tonumber(guardTime)\n+    if guardTimeNum and guardTimeNum > fetchTimeMs then\n+        return \"STALE_WRITE\"\n+    end\n+end\n \n -- Check if cache already exists (skip this check if overwrite is true)\n if not overwrite then\ndiff --git a/server/src/external/stripe/webhookHandlers/handleStripeSubscriptionUpdated/tasks/handleStripeSubscriptionCanceled/isStripeSubscriptionCanceledEvent.ts b/server/src/external/stripe/webhookHandlers/handleStripeSubscriptionUpdated/tasks/handleStripeSubscriptionCanceled/isStripeSubscriptionCanceledEvent.ts\nindex 7291d080..27800df9 100644\n--- a/server/src/external/stripe/webhookHandlers/handleStripeSubscriptionUpdated/tasks/handleStripeSubscriptionCanceled/isStripeSubscriptionCanceledEvent.ts\n+++ b/server/src/external/stripe/webhookHandlers/handleStripeSubscriptionUpdated/tasks/handleStripeSubscriptionCanceled/isStripeSubscriptionCanceledEvent.ts\n@@ -33,19 +33,14 @@ export const isStripeSubscriptionCanceledEvent = ({\n \n \t// Check if this event represents a new cancellation\n \tconst cancelAtPeriodEndChanged =\n-\t\t\"cancel_at_period_end\" in previousAttributes &&\n \t\t!previousAttributes.cancel_at_period_end &&\n \t\tstripeSubscription.cancel_at_period_end;\n \n \tconst cancelAtChanged =\n-\t\t\"cancel_at\" in previousAttributes &&\n-\t\tnullish(previousAttributes.cancel_at) &&\n-\t\tstripeSubscription.cancel_at;\n+\t\tnullish(previousAttributes.cancel_at) && stripeSubscription.cancel_at;\n \n \tconst canceledAtChanged =\n-\t\t\"canceled_at\" in previousAttributes &&\n-\t\tnullish(previousAttributes.canceled_at) &&\n-\t\tstripeSubscription.canceled_at;\n+\t\tnullish(previousAttributes.canceled_at) && stripeSubscription.canceled_at;\n \n \tconst canceled =\n \t\tcancelAtPeriodEndChanged || cancelAtChanged || canceledAtChanged;\ndiff --git a/server/src/internal/customers/CusService.ts b/server/src/internal/customers/CusService.ts\nindex 1a20cc08..39e031f9 100644\n--- a/server/src/internal/customers/CusService.ts\n+++ b/server/src/internal/customers/CusService.ts\n@@ -241,20 +241,15 @@ export class CusService {\n \t}\n \n \t/**\n-\t * Insert a new customer, or claim an existing null-ID customer by email.\n+\t * Upsert a customer using the email + null ID constraint.\n \t *\n-\t * Behavior:\n-\t * - If customer with same ID exists: return existing (no update)\n-\t * - If customer with same email exists with id=NULL and new request has ID: claim it (set ID only)\n-\t * - If customer with same email exists with id=NULL and new request has id=NULL: return existing\n-\t * - Otherwise: insert new customer\n+\t * If a customer with the same (org_id, env, email) exists with id = NULL,\n+\t * update that row with the new customer data (including the new ID).\n+\t * Otherwise, insert a new row.\n \t *\n-\t * IMPORTANT: Only updates the `id` field when claiming. Does NOT update any other fields.\n-\t * This prevents race conditions where concurrent requests could overwrite data.\n-\t *\n-\t * Returns { customer, wasUpdate } where wasUpdate=true if customer already existed.\n+\t * Returns { customer, wasUpdate } to indicate if an existing row was updated.\n \t */\n-\tstatic async insertOrClaimEmail({\n+\tstatic async upsert({\n \t\tdb,\n \t\tdata,\n \t}: {\n@@ -262,12 +257,12 @@ export class CusService {\n \t\tdata: Customer;\n \t}): Promise<{ customer: Customer; wasUpdate: boolean }> {\n \t\tconst columns = getTableColumns(customers);\n-\t\tconst columnEntries = Object.entries(columns);\n-\t\tconst columnNames = columnEntries.map(([_, col]) => col.name);\n+\t\tconst columnNames = Object.values(columns).map((col) => col.name);\n \n-\t\t// Build values array in same order as columnNames\n-\t\tconst values = columnEntries.map(([key, col]) => {\n+\t\t// Build values array, handling jsonb columns specially\n+\t\tconst values = Object.entries(columns).map(([key, col]) => {\n \t\t\tconst value = data[key as keyof Customer];\n+\t\t\t// jsonb columns need JSON.stringify\n \t\t\tif (col.dataType === \"json\") {\n \t\t\t\tconst jsonValue =\n \t\t\t\t\tvalue !== undefined && value !== null\n@@ -280,6 +275,31 @@ export class CusService {\n \t\t\treturn sql`${value ?? null}`;\n \t\t});\n \n+\t\t// Build UPDATE SET clauses\n+\t\tconst excludeFromUpdate = [\"internal_id\", \"org_id\", \"env\", \"created_at\"];\n+\n+\t\t// For ON CONFLICT - uses EXCLUDED.column_name\n+\t\tconst updateColsExcluded = Object.values(columns)\n+\t\t\t.filter((col) => !excludeFromUpdate.includes(col.name))\n+\t\t\t.map((col) => sql.raw(`${col.name} = EXCLUDED.${col.name}`));\n+\n+\t\t// For CTE claim UPDATE - uses direct values\n+\t\tconst updateColsValues = Object.entries(columns)\n+\t\t\t.filter(([_, col]) => !excludeFromUpdate.includes(col.name))\n+\t\t\t.map(([key, col]) => {\n+\t\t\t\tconst value = data[key as keyof Customer];\n+\t\t\t\tif (col.dataType === \"json\") {\n+\t\t\t\t\tconst jsonValue =\n+\t\t\t\t\t\tvalue !== undefined && value !== null\n+\t\t\t\t\t\t\t? JSON.stringify(value)\n+\t\t\t\t\t\t\t: col.default !== undefined\n+\t\t\t\t\t\t\t\t? \"{}\"\n+\t\t\t\t\t\t\t\t: \"null\";\n+\t\t\t\t\treturn sql`${sql.raw(col.name)} = ${jsonValue}::jsonb`;\n+\t\t\t\t}\n+\t\t\t\treturn sql`${sql.raw(col.name)} = ${value ?? null}`;\n+\t\t\t});\n+\n \t\t// Conflict target differs based on incoming id:\n \t\t// - id != NULL: Use cus_id_constraint (handles ID collisions)\n \t\t// - id = NULL: Use partial index (handles email collisions for null-id rows)\n@@ -289,19 +309,18 @@ export class CusService {\n \t\t\t\t: sql`ON CONFLICT (org_id, env, lower(email)) WHERE id IS NULL AND email IS NOT NULL AND email != ''`;\n \n \t\t// CTE handles all cases:\n-\t\t// - Claim: If email exists with id=NULL and new request has ID, set the ID (claim the customer)\n-\t\t// - Insert: If no claim happened, try to insert\n-\t\t// - On conflict: Do nothing (customer already exists), xmax will indicate it was an update\n+\t\t// - Case A (id=NULL \u2192 id=NULL same email): claim updates existing\n+\t\t// - Case B (id=x \u2192 id=x): insert_new conflicts on cus_id_constraint, upserts\n+\t\t// - Case C (id=NULL \u2192 id=y same email): claim updates existing, sets new id\n \t\tconst results = await db.execute<\n \t\t\tCustomer & { xmax: string; was_claim: boolean }\n \t\t>(sql`\n \t\t\tWITH claim AS (\n \t\t\t\tUPDATE customers\n-\t\t\t\tSET id = ${data.id}\n+\t\t\t\tSET ${sql.join(updateColsValues, sql`, `)}\n \t\t\t\tWHERE org_id = ${data.org_id}\n \t\t\t\t\tAND env = ${data.env}\n \t\t\t\t\tAND id IS NULL\n-\t\t\t\t\tAND ${data.id}::text IS NOT NULL\n \t\t\t\t\tAND email IS NOT NULL\n \t\t\t\t\tAND lower(email) = lower(${data.email ?? \"\"})\n \t\t\t\tRETURNING *, xmax::text, true as was_claim\n@@ -311,7 +330,7 @@ export class CusService {\n \t\t\t\tSELECT ${sql.join(values, sql`, `)}\n \t\t\t\tWHERE NOT EXISTS (SELECT 1 FROM claim)\n \t\t\t\t${conflictClause}\n-\t\t\t\tDO UPDATE SET id = customers.id\n+\t\t\t\tDO UPDATE SET ${sql.join(updateColsExcluded, sql`, `)}\n \t\t\t\tRETURNING *, xmax::text, false as was_claim\n \t\t\t)\n \t\t\tSELECT * FROM claim\n@@ -321,7 +340,7 @@ export class CusService {\n \n \t\tif (results && results.length > 0) {\n \t\t\tconst { xmax, was_claim, ...customer } = results[0];\n-\t\t\t// wasUpdate if: claimed existing row OR xmax indicates update (conflict happened)\n+\t\t\t// wasUpdate if: claimed existing row OR xmax indicates update\n \t\t\tconst wasUpdate = was_claim || xmax !== \"0\";\n \t\t\treturn { customer: customer as Customer, wasUpdate };\n \t\t}\ndiff --git a/server/src/internal/customers/actions/createWithDefaults/execute/executeAutumnCreateCustomerPlan.ts b/server/src/internal/customers/actions/createWithDefaults/execute/executeAutumnCreateCustomerPlan.ts\nindex 34194bfa..6e1b6aed 100644\n--- a/server/src/internal/customers/actions/createWithDefaults/execute/executeAutumnCreateCustomerPlan.ts\n+++ b/server/src/internal/customers/actions/createWithDefaults/execute/executeAutumnCreateCustomerPlan.ts\n@@ -1,9 +1,9 @@\n-import type { AutumnBillingPlan } from \"@autumn/shared\";\n import { AuthType, CusExpand, tryCatch } from \"@autumn/shared\";\n import { isUniqueConstraintError } from \"@/db/dbUtils.js\";\n import type { DrizzleCli } from \"@/db/initDrizzle.js\";\n import type { AutumnContext } from \"@/honoUtils/HonoEnv.js\";\n import { executeAutumnBillingPlan } from \"@/internal/billing/v2/execute/executeAutumnBillingPlan.js\";\n+import type { AutumnBillingPlan } from \"@autumn/shared\";\n import { billingPlanToSendProductsUpdated } from \"@/internal/billing/v2/workflows/sendProductsUpdated/billingPlanToSendProductsUpdated.js\";\n import type { CreateCustomerContext } from \"@/internal/customers/actions/createWithDefaults/createCustomerContext.js\";\n import { captureOrgEvent } from \"@/utils/posthog.js\";\n@@ -37,7 +37,7 @@ export const executeAutumnCreateCustomerPlan = async ({\n \t\tdb.transaction(async (tx) => {\n \t\t\tconst txDb = tx as unknown as DrizzleCli;\n \n-\t\t\tconst upsertResult = await CusService.insertOrClaimEmail({\n+\t\t\tconst upsertResult = await CusService.upsert({\n \t\t\t\tdb: txDb,\n \t\t\t\tdata: fullCustomer,\n \t\t\t});\ndiff --git a/shared/utils/productV2Utils/compareProductUtils/generateItemChanges.ts b/shared/utils/productV2Utils/compareProductUtils/generateItemChanges.ts\nindex ca46fa87..0ffc34f2 100644\n--- a/shared/utils/productV2Utils/compareProductUtils/generateItemChanges.ts\n+++ b/shared/utils/productV2Utils/compareProductUtils/generateItemChanges.ts\n@@ -6,6 +6,49 @@ import {\n } from \"../../../models/productV2Models/productItemModels/productItemModels.js\";\n import type { ItemEdit } from \"./itemEditTypes.js\";\n \n+/** Keys that are internal/metadata and should not trigger change detection */\n+const INTERNAL_KEYS = new Set([\n+\t\"feature_id\", // Used as identifier, not for change detection\n+\t\"feature_type\", // Internal - derived from feature\n+\t\"feature\", // Internal - full feature object\n+\t\"display\", // Internal - UI display text\n+\t\"usage_limit\", // Internal - hidden from users\n+\t\"created_at\", // Internal - timestamp metadata\n+\t\"entitlement_id\", // Internal - backend identifier\n+\t\"price_id\", // Internal - backend identifier\n+\t\"price_config\", // Internal - backend config\n+\t\"isPrice\", // Frontend-only extension\n+\t\"isVariable\", // Frontend-only extension\n+]);\n+\n+/** Recursively sorts object keys and normalizes undefined to null for consistent comparison */\n+function sortAndNormalize(value: unknown): unknown {\n+\tif (value === undefined || value === null) return null;\n+\tif (Array.isArray(value)) {\n+\t\treturn value.map(sortAndNormalize);\n+\t}\n+\tif (typeof value === \"object\") {\n+\t\tconst sorted: Record<string, unknown> = {};\n+\t\tfor (const key of Object.keys(value).sort()) {\n+\t\t\tsorted[key] = sortAndNormalize((value as Record<string, unknown>)[key]);\n+\t\t}\n+\t\treturn sorted;\n+\t}\n+\treturn value;\n+}\n+\n+/** Creates a normalized string representation of a ProductItem excluding internal keys */\n+function normalizeForComparison(item: ProductItem): string {\n+\tconst sanitized: Record<string, unknown> = {};\n+\n+\tfor (const [key, value] of Object.entries(item)) {\n+\t\tif (INTERNAL_KEYS.has(key)) continue;\n+\t\tsanitized[key] = value;\n+\t}\n+\n+\treturn JSON.stringify(sortAndNormalize(sanitized));\n+}\n+\n function hasValue<T>(value: T | null | undefined): value is T {\n \treturn value !== null && value !== undefined;\n }\n@@ -232,11 +275,7 @@ function hasItemChanged({\n \tupdatedItem: ProductItem;\n }): boolean {\n \treturn (\n-\t\toriginalItem.price !== updatedItem.price ||\n-\t\toriginalItem.included_usage !== updatedItem.included_usage ||\n-\t\tJSON.stringify(originalItem.tiers) !== JSON.stringify(updatedItem.tiers) ||\n-\t\toriginalItem.billing_units !== updatedItem.billing_units ||\n-\t\toriginalItem.interval !== updatedItem.interval\n+\t\tnormalizeForComparison(originalItem) !== normalizeForComparison(updatedItem)\n \t);\n }\n \ndiff --git a/vite/src/components/general/table/table-content-virtualized.tsx b/vite/src/components/general/table/table-content-virtualized.tsx\nindex 0dbfa259..f47b01cc 100644\n--- a/vite/src/components/general/table/table-content-virtualized.tsx\n+++ b/vite/src/components/general/table/table-content-virtualized.tsx\n@@ -19,6 +19,7 @@ export function TableContentVirtualized({\n \t\tflexibleTableColumns,\n \t\tenableColumnVisibility,\n \t\tcolumnVisibilityInToolbar,\n+\t\tcolumnVisibilityClassName,\n \t\ttable,\n \t\tvirtualization,\n \t} = context;\n@@ -49,9 +50,17 @@ export function TableContentVirtualized({\n \n \t// minHeight ensures usability on small screens, but only when content would exceed it\n \t// This allows small tables to be exactly as tall as their content\n+\t// Skip minHeight if containerHeight is explicitly set to a small value\n \tconst MIN_TABLE_HEIGHT = 400;\n+\tconst containerHeightPx = virtualization?.containerHeight\n+\t\t? Number.parseInt(virtualization.containerHeight, 10)\n+\t\t: undefined;\n \tconst minHeight =\n-\t\tcontentHeight > MIN_TABLE_HEIGHT ? MIN_TABLE_HEIGHT : undefined;\n+\t\tcontainerHeightPx && containerHeightPx < MIN_TABLE_HEIGHT\n+\t\t\t? undefined\n+\t\t\t: contentHeight > MIN_TABLE_HEIGHT\n+\t\t\t\t? MIN_TABLE_HEIGHT\n+\t\t\t\t: undefined;\n \n \t// Calculate total width from visible columns to sync header and body tables\n \tconst visibleColumns = table.getVisibleLeafColumns();\n@@ -105,7 +114,12 @@ export function TableContentVirtualized({\n \t\t\t\t\t>\n \t\t\t\t\t\t{/* Column visibility toggle - only render if not in toolbar */}\n \t\t\t\t\t\t{enableColumnVisibility && !columnVisibilityInToolbar && (\n-\t\t\t\t\t\t\t<div className=\"absolute right-7 top-1 z-45\">\n+\t\t\t\t\t\t\t<div\n+\t\t\t\t\t\t\t\tclassName={cn(\n+\t\t\t\t\t\t\t\t\t\"absolute right-7 top-1 z-45\",\n+\t\t\t\t\t\t\t\t\tcolumnVisibilityClassName,\n+\t\t\t\t\t\t\t\t)}\n+\t\t\t\t\t\t\t>\n \t\t\t\t\t\t\t\t<TableColumnVisibility />\n \t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t)}\ndiff --git a/vite/src/components/general/table/table-context.tsx b/vite/src/components/general/table/table-context.tsx\nindex 7496987a..d0f99f65 100644\n--- a/vite/src/components/general/table/table-context.tsx\n+++ b/vite/src/components/general/table/table-context.tsx\n@@ -23,6 +23,8 @@ export interface TableProps<T> {\n \tcolumnGroups?: ColumnGroup[];\n \t/** Render column visibility in the toolbar instead of inside table content */\n \tcolumnVisibilityInToolbar?: boolean;\n+\t/** Custom className for the column visibility button container (for positioning overrides) */\n+\tcolumnVisibilityClassName?: string;\n \t/** For navigation - returns href string, enables cmd+click to open in new tab */\n \tgetRowHref?: (row: T) => string;\n \t/** For non-navigation actions like opening sheets/modals */\ndiff --git a/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsColumns.tsx b/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsColumns.tsx\nindex 7268bd43..128a1558 100644\n--- a/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsColumns.tsx\n+++ b/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsColumns.tsx\n@@ -56,6 +56,16 @@ export const CustomerUsageAnalyticsColumns: ColumnDef<Event>[] = [\n \t},\n ];\n \n+/** Checks if a property value is displayable as a table column */\n+function isDisplayableProperty(key: string, value: unknown): boolean {\n+\tif (key === \"value\") return false;\n+\treturn (\n+\t\ttypeof value === \"string\" ||\n+\t\ttypeof value === \"number\" ||\n+\t\ttypeof value === \"boolean\"\n+\t);\n+}\n+\n /** Generates dynamic columns from event properties */\n export function generatePropertyColumns({\n \tevents,\n@@ -65,12 +75,12 @@ export function generatePropertyColumns({\n \tconst propertyKeys = new Set<string>();\n \n \tfor (const event of events) {\n-\t\tif (event.properties) {\n-\t\t\tfor (const key of Object.keys(event.properties)) {\n-\t\t\t\t// Skip 'value' as it's already a base column\n-\t\t\t\tif (key !== \"value\") {\n-\t\t\t\t\tpropertyKeys.add(key);\n-\t\t\t\t}\n+\t\tconst props = event.properties;\n+\t\tif (!props || typeof props !== \"object\" || Array.isArray(props)) continue;\n+\n+\t\tfor (const [key, value] of Object.entries(props)) {\n+\t\t\tif (isDisplayableProperty(key, value)) {\n+\t\t\t\tpropertyKeys.add(key);\n \t\t\t}\n \t\t}\n \t}\n@@ -85,8 +95,8 @@ export function generatePropertyColumns({\n \t\t\tif (typeof value === \"object\") return JSON.stringify(value);\n \t\t\treturn String(value);\n \t\t},\n-\t\tcell: ({ getValue }: { getValue: () => string }) => {\n-\t\t\tconst value = getValue();\n+\t\tcell: ({ getValue }: { getValue: () => unknown }) => {\n+\t\t\tconst value = String(getValue() ?? \"\");\n \t\t\treturn (\n \t\t\t\t<div className=\"text-t3 text-tiny truncate font-mono\">{value}</div>\n \t\t\t);\ndiff --git a/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsTable.tsx b/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsTable.tsx\nindex ac02cf6c..65f0baee 100644\n--- a/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsTable.tsx\n+++ b/vite/src/views/customers2/components/table/customer-usage-analytics/CustomerUsageAnalyticsTable.tsx\n@@ -6,7 +6,6 @@ import { Table } from \"@/components/general/table\";\n import { IconButton } from \"@/components/v2/buttons/IconButton\";\n import { LoadingShimmerText } from \"@/components/v2/LoadingShimmerText\";\n import { useColumnVisibility } from \"@/hooks/useColumnVisibility\";\n-import { cn } from \"@/lib/utils\";\n import { useEnv } from \"@/utils/envUtils\";\n import { useCusEventsQuery } from \"@/views/customers/customer/hooks/useCusEventsQuery\";\n import { useCustomerTable } from \"@/views/customers2/hooks/useCustomerTable\";\n@@ -110,6 +109,12 @@ export function CustomerUsageAnalyticsTable() {\n \t\t\t\t\tflexibleTableColumns: true,\n \t\t\t\t\tenableColumnVisibility: true,\n \t\t\t\t\tcolumnVisibilityStorageKey: \"customer-usage-analytics\",\n+\t\t\t\t\tcolumnVisibilityClassName: \"right-3\",\n+\t\t\t\t\tvirtualization: {\n+\t\t\t\t\t\tcontainerHeight: \"250px\",\n+\t\t\t\t\t\trowHeight: 32,\n+\t\t\t\t\t\toverscan: 15,\n+\t\t\t\t\t},\n \t\t\t\t}}\n \t\t\t>\n \t\t\t\t<Table.Container>\n@@ -126,21 +131,18 @@ export function CustomerUsageAnalyticsTable() {\n \t\t\t\t\t\t\t<CustomerUsageAnalyticsFullButton />\n \t\t\t\t\t\t</Table.Actions>\n \t\t\t\t\t</Table.Toolbar>\n-\t\t\t\t\t<div className=\"flex w-full gap-2 \">\n+\t\t\t\t\t<div className=\"flex flex-col lg:flex-row w-full gap-4 lg:gap-2\">\n \t\t\t\t\t\t{isLoading ? (\n \t\t\t\t\t\t\t<EmptyState text={<LoadingShimmerText text=\"Loading events\" />} />\n \t\t\t\t\t\t) : hasEvents ? (\n \t\t\t\t\t\t\t<>\n-\t\t\t\t\t\t\t\t<Table.Content\n-\t\t\t\t\t\t\t\t\tclassName={cn(\n-\t\t\t\t\t\t\t\t\t\t\"rounded-lg bg-card w-full max-w-1/2 h-[250px]\",\n-\t\t\t\t\t\t\t\t\t)}\n-\t\t\t\t\t\t\t\t>\n-\t\t\t\t\t\t\t\t\t<Table.Header />\n-\t\t\t\t\t\t\t\t\t<Table.Body />\n-\t\t\t\t\t\t\t\t</Table.Content>\n+\t\t\t\t\t\t\t\t<div className=\"w-full lg:max-w-1/2\">\n+\t\t\t\t\t\t\t\t\t<Table.VirtualizedContent className=\"rounded-lg bg-card w-full max-h-[250px]\">\n+\t\t\t\t\t\t\t\t\t\t<Table.VirtualizedBody />\n+\t\t\t\t\t\t\t\t\t</Table.VirtualizedContent>\n+\t\t\t\t\t\t\t\t</div>\n \n-\t\t\t\t\t\t\t\t<div className=\"flex max-w-1/2 w-full min-w-0 h-[250px]\">\n+\t\t\t\t\t\t\t\t<div className=\"flex lg:max-w-1/2 w-full min-w-0 h-[250px]\">\n \t\t\t\t\t\t\t\t\t<CustomerUsageAnalyticsChart\n \t\t\t\t\t\t\t\t\t\ttimeseriesEvents={timeseriesEvents}\n \t\t\t\t\t\t\t\t\t\tdaysToShow={selectedDays ?? 7}\ndiff --git a/vite/src/views/onboarding4/OnboardingGuide.tsx b/vite/src/views/onboarding4/OnboardingGuide.tsx\nindex 0ec058a5..6aae83bc 100644\n--- a/vite/src/views/onboarding4/OnboardingGuide.tsx\n+++ b/vite/src/views/onboarding4/OnboardingGuide.tsx\n@@ -271,8 +271,8 @@ export function OnboardingGuide() {\n \n \tif (isLoading) {\n \t\treturn (\n-\t\t\t<div className=\"relative overflow-hidden border-dashed border-b pb-4 mb-2\">\n-\t\t\t\t{/* Header skeleton */}\n+\t\t<div className=\"relative overflow-x-clip border-dashed border-b pb-4 mb-2\">\n+\t\t\t{/* Header skeleton */}\n \t\t\t\t<div className=\"pr-8 mb-2.75\">\n \t\t\t\t\t<div className=\"flex items-center gap-2\">\n \t\t\t\t\t\t<Skeleton className=\"h-3.5 w-36\" />\n@@ -290,7 +290,7 @@ export function OnboardingGuide() {\n \t}\n \n \treturn (\n-\t\t<div className=\"relative overflow-hidden border-dashed border-b pb-4 mb-2\">\n+\t\t<div className=\"relative overflow-x-clip border-dashed border-b pb-4 mb-2\">\n \t\t\t{/* Dismiss button */}\n \t\t\t<Tooltip>\n \t\t\t\t<TooltipTrigger asChild>\n",
  "test_patch": "diff --git a/server/tests/integration/crud/customers/create-customer-null-id.test.ts b/server/tests/integration/crud/customers/create-customer-null-id.test.ts\nindex 717d445e..35859cf0 100644\n--- a/server/tests/integration/crud/customers/create-customer-null-id.test.ts\n+++ b/server/tests/integration/crud/customers/create-customer-null-id.test.ts\n@@ -65,7 +65,7 @@ test.concurrent(`${chalk.yellowBright(\"null-id: duplicate null ID + same email r\n \texpect(data2.autumn_id).toBe(data1.autumn_id);\n \texpect(data2.email).toBe(email);\n \t// Name should be updated (upsert behavior)\n-\texpect(data2.name).toBe(\"First Customer\");\n+\texpect(data2.name).toBe(\"Second Customer\");\n \n \t// Verify second create also returns customer with default product\n \tconst customer2 = await autumnV1.customers.get<ApiCustomerV3>(\n@@ -269,5 +269,5 @@ test(`${chalk.yellowBright(\"null-id: case-insensitive email matching returns exi\n \t// Should return the same customer\n \texpect(data2.autumn_id).toBe(data1.autumn_id);\n \t// Name should be updated (upsert behavior)\n-\texpect(data2.name).toBe(\"Lowercase Email\");\n+\texpect(data2.name).toBe(\"Uppercase Email\");\n });\ndiff --git a/server/tests/integration/crud/customers/create-customer-race.test.ts b/server/tests/integration/crud/customers/create-customer-race.test.ts\nindex 245ace45..f54e2796 100644\n--- a/server/tests/integration/crud/customers/create-customer-race.test.ts\n+++ b/server/tests/integration/crud/customers/create-customer-race.test.ts\n@@ -284,60 +284,3 @@ test.concurrent(`${chalk.yellowBright(\"race: concurrent create with default tria\n \t\tenv: ctx.env,\n \t});\n });\n-\n-test.concurrent(`${chalk.yellowBright(\"race: concurrent create with name vs without name preserves name\")}`, async () => {\n-\tconst customerId = \"race-name-preserve-test\";\n-\tconst customerName = \"John Doe\";\n-\n-\tconst { autumnV1 } = await initScenario({\n-\t\tsetup: [s.deleteCustomer({ customerId })],\n-\t\tactions: [],\n-\t});\n-\n-\t// Concurrent creates: first with name, second without name\n-\t// The name should be preserved regardless of which request wins the race\n-\tconst results = await Promise.all([\n-\t\tautumnV1.customers.create({\n-\t\t\tid: customerId,\n-\t\t\tname: customerName,\n-\t\t\temail: `${customerId}@example.com`,\n-\t\t\twithAutumnId: true,\n-\t\t\tinternalOptions: {\n-\t\t\t\tdisable_defaults: true,\n-\t\t\t},\n-\t\t}),\n-\t\tautumnV1.customers.create({\n-\t\t\tid: customerId,\n-\t\t\t// No name provided\n-\n-\t\t\twithAutumnId: true,\n-\t\t\tinternalOptions: {\n-\t\t\t\tdisable_defaults: true,\n-\t\t\t},\n-\t\t}),\n-\t\tautumnV1.customers.create({\n-\t\t\tid: customerId,\n-\t\t\t// No name provided\n-\n-\t\t\twithAutumnId: true,\n-\t\t\tinternalOptions: {\n-\t\t\t\tdisable_defaults: true,\n-\t\t\t},\n-\t\t}),\n-\t]);\n-\n-\t// All should return the same customer\n-\tconst autumnIds = results.map((r) => r.autumn_id);\n-\texpect(new Set(autumnIds).size).toBe(1);\n-\n-\t// Get the final customer state from DB\n-\tconst finalCustomer = await CusService.getFull({\n-\t\tdb: ctx.db,\n-\t\tidOrInternalId: customerId,\n-\t\torgId: ctx.org.id,\n-\t\tenv: ctx.env,\n-\t});\n-\n-\t// Name should be preserved - not overwritten with empty string\n-\texpect(finalCustomer.name).toBe(customerName);\n-});\n",
  "hints_text": "",
  "environment_setup_commit": "e61d4fd83b4c74ada22c60600606f0f19386639f",
  "install_config": {
    "python": "N/A",
    "packages": "N/A",
    "install": "bun install && bun setup && bun db:generate && bun db:migrate",
    "test_cmd": "cd server && bun test:integration",
    "pre_install": [],
    "reqs_path": [],
    "env_yml_path": [],
    "pip_packages": []
  },
  "meta": {
    "commit_name": "head_commit",
    "num_modified_files": 10,
    "has_test_patch": true,
    "is_lite": false,
    "llm_score": {
      "difficulty_score": null,
      "issue_text_score": null,
      "test_score": null
    },
    "solution_lines": 210,
    "lines_added": 150,
    "lines_removed": 60,
    "repo_stars": 2338,
    "repo_forks": 181,
    "repo_contributors": 5,
    "has_ci": true,
    "has_test_framework": false,
    "is_archived": false,
    "is_fork": false
  },
  "license_name": "Apache-2.0",
  "FAIL_TO_PASS": [],
  "PASS_TO_PASS": [],
  "requirements": "",
  "environment": ""
}